{"version":3,"sources":["../../src/pages/scan/scan.ts","../../src/pages/scan/scan.module.ts"],"names":[],"mappings":"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","file":"7.js","sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport {IonicPage, NavController, NavParams, ViewController, Events, AlertController, Alert} from 'ionic-angular';\nimport { QRScanner, QRScannerStatus } from '@ionic-native/qr-scanner';\nimport {CommonUtils} from '../../providers/common/commonUtils'\nimport { Buffer } from 'buffer';\nimport { TranslateModule,TranslateService} from 'ng2-translate';\nimport { NativeService } from '../../providers/updateApp/NativeService'\n/**\n * Generated class for the ScanPage page.\n *\n * See https://ionicframework.com/docs/components/#navigation for more info on\n * Ionic pages and navigation.\n */\n\n@IonicPage()\n@Component({\n  selector: 'page-scan',\n  templateUrl: 'scan.html',\n})\nexport class ScanPage {\n  protected light: boolean = false;\n  protected frontCamera: boolean = false;\n    translateObj:any;\n    alert:Alert;\n    animate:any;\n  constructor(\n    public navCtrl: NavController,\n    public commonUtils:CommonUtils,\n    private translate:TranslateService,\n    public navParams: NavParams,\n    private nativeService:NativeService,\n    private qrScanner: QRScanner,\n    public viewCtrl: ViewController,\n    private event: Events,\n    private alertCtrl:AlertController\n  ) {\n      if(this.nativeService.isIos()){\n          this.animate = false;\n      }else{\n          this.animate = true;\n      }\n      translate.get('home').subscribe((res: string) => {\n          this.translateObj = res;\n      });\n  }\n  ionViewDidEnter(){\n        //页面可见时才执行\n        this.showCamera();\n        this.ngOnInitDid();\n  }\n\n\nngOnInitDid() {\n      // let text = \"eyJBY2NvdW50IjoibnAxODgxMTQ0NDc1NiIsImN1cnJlbmN5IjoiYml0Q05ZIiwibW9uZXkiOiIxMCIsInJlYXNvbiI6IueMqiJ9\"\n      //  let text='eyJBY2NvdW50Ijoid3AzMzQ0IiwiY3VycmVuY3kiOiJZVFNVU0QiLCJtb25leSI6MywicmVhc29uIjoiIn0='\n      // console.log(new Buffer(text,'base64').toString());//解码\n      // let QQ =  new Buffer(text,'base64').toString();\n      // console.log(this.isContains(QQ,'Account'))\n      // if(this.isContains(QQ,'Account') && this.isContains(QQ,'currency') && this.isContains(QQ,'money')){\n      //     // alert(\"正确\")\n      //     // this.qrScanner.hide(); // hide camera preview\n      //     // scanSub.unsubscribe(); // stop scanning\n      //     this.navCtrl.push('accountPayPage',{barcodeData:QQ});\n      //\n      // }else {\n      //      this.commonUtils.alertCommon( this.translateObj.warning, this.translateObj.scanErr);\n      //      this.navCtrl.pop();\n      // }\n    this.qrScanner.prepare()\n      .then((status: QRScannerStatus) => {\n        console.log(status)\n        if (status.authorized) {\n          // camera permission was granted\n          window.document.querySelector('body').classList.add('transparent-body');\n          let scanSub = this.qrScanner.scan().subscribe((text: string) => {\n                  // \"eyJBY2NvdW50IjoibnAxODgxMTQ0NDc1NiIsImN1cnJlbmN5IjoiYml0Q05ZIiwibW9uZXkiOiIxMCIsInJlYXNvbiI6IueMqiJ9\"\n                  //  let text='eyJBY2NvdW50IjoibW8xMTAyMDIiLCJjdXJyZW5jeSI6IllUUyIsIm1vbmV5IjoxMCwicmVhc29uIjoiIn0'\n                   console.log(new Buffer(text,'base64').toString());//解码\n                   let QQ =  new Buffer(text,'base64').toString();\n                   console.log(this.isContains(QQ,'Account'))\n                   if(this.isContains(QQ,'Account') && this.isContains(QQ,'currency') && this.isContains(QQ,'money')){\n                       // alert(\"正确\")\n                       this.qrScanner.hide(); // hide camera preview\n                       scanSub.unsubscribe(); // stop scanning\n                       if(JSON.parse(QQ).Account === localStorage.getItem(\"account\")){\n                           this.showPopup(this.translateObj.warning,this.translateObj.scanSelf);\n                           return;\n                       }else{\n                           this.navCtrl.push('accountPayPage',{barcodeData:QQ});\n                       }\n\n                   }else {\n                       this.showPopup(this.translateObj.warning,this.translateObj.scanErr);\n                   }\n\n\n          });\n          // show camera preview\n          this.qrScanner.show();\n\n          // wait for user to scan something, then the observable callback will be called\n        } else if (status.denied) {\n            // this.qrScanner.openSettings();\n            this.commonUtils.alertCommon( this.translateObj.warning, '调用扫码权限失败')\n          // camera permission was permanently denied\n          // you must use QRScanner.openSettings() method to guide the user to the settings page\n          // then they can grant the permission from there\n        } else {\n            // permission was denied, but not permanently. You can ask for permission again at a later time.\n            // this.commonUtils.alertCommon( this.translateObj.warning, '调用扫码权限失败');\n            // this.navCtrl.pop();\n            this.qrScanner.openSettings();\n        }\n      })\n      .catch((e: any) =>\n      {   console.log('Error is', e);\n          this.showPopup(this.translateObj.warning,this.translateObj.scanfail);\n      });\n  }\n    showPopup(title, text) {\n       this.alert = this.alertCtrl.create({\n            cssClass:'projectList',\n            title: title,\n            subTitle: text,\n            buttons: [\n                {\n                    text: this.translateObj.confrim,\n                    handler: data => {\n                        this.navCtrl.pop();\n                        // this.navCtrl.push('accountPayPage',{barcodeData:'{\"Account\":\"npqp18811444000\",\"currency\":\"\",\"money\":\"\",\"reason\":\"\"}'});\n                    }\n                }\n            ]\n        });\n        this.alert.present();\n    }\n    isContains(str, substr) {\n        return str.indexOf(substr) >= 0;\n    }\n  public dismiss(): void {\n      console.log(\"关闭二维码扫码\")\n    // this.viewCtrl.dismiss();\n      this.navCtrl.pop({animate:this.animate});\n  }\n  toggleLight() {\n      console.log(this.light)\n    this.light = !this.light;\n    if (this.light) {\n        this.qrScanner.enableLight();\n    } else {\n        this.qrScanner.disableLight();\n    }\n  }\n  toggleCamera() {\n      console.log(this.frontCamera)\n    this.frontCamera = !this.frontCamera;\n    if (this.frontCamera) {\n        this.qrScanner.useFrontCamera();\n    } else {\n        this.qrScanner.useBackCamera();\n    }\n  }\n\n    showCamera() {\n        (window.document.querySelector('ion-app') as HTMLElement).classList.add('cameraView');\n    }\n    hideCamera() {\n        this.qrScanner.hide();//需要关闭扫描，否则相机一直开着\n        // (window.document.querySelector('ion-app') as HTMLElement).classList.remove('cameraView');\n    }\n\n\n    ionViewWillEnter() {\n        let elements = document.querySelectorAll(\".tabbar\");\n        if (elements != null) {\n            Object.keys(elements).map((key) => {\n                elements[key].style.display = 'none';\n            });\n        }\n    }\n    ionViewWillLeave() {\n      this.hideCamera();\n        let elements = document.querySelectorAll(\".tabbar\");\n        if (elements != null) {\n            Object.keys(elements).map((key) => {\n                elements[key].style.display = 'flex';\n            });\n        }\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/scan/scan.ts","import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ScanPage } from './scan';\n\n@NgModule({\n  declarations: [\n    ScanPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(ScanPage),\n  ],\n  exports:[ScanPage]\n})\nexport class ScanPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/scan/scan.module.ts"],"sourceRoot":""}