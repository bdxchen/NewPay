{"version":3,"sources":["../../src/pages/mine/my-wallet/recovery-import/recovery-import.ts","../../src/pages/mine/my-wallet/recovery-import/recovery-import.module.ts"],"names":[],"mappings":"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","file":"12.js","sourcesContent":["import { Component } from '@angular/core';\nimport {\n    Alert, AlertController, IonicPage, NavController, NavParams, ModalController,\n    ToastController, Loading, Modal\n} from 'ionic-angular';\nimport { NewpayInstance } from 'newpay-wallet-js';\nimport 'rxjs/add/operator/toPromise';\nimport { ModalPage } from  '../../../modal/modal';\nimport  { RecoveryImportService } from '../../../../providers/wallet/recovery-import-service'\nimport {StorageService} from  '../../../../providers/util-service/storage-service';\nimport { CommonUtils} from '../../../../providers/common/commonUtils'\nimport {lifecycleHookToNodeFlag} from \"@angular/compiler/src/view_compiler/provider_compiler\";\nimport { TranslateService } from 'ng2-translate';\nimport { PincodeController } from  'ionic2-pincode-input/dist/pincode'\n/**\n * Generated class for the RecoveryImportPage page.\n *\n * See http://ionicframework.com/docs/components/#navigation for more info\n * on Ionic pages and navigation.\n */\n\n@IonicPage()\n@Component({\n  selector: 'page-recovery-import',\n  templateUrl: 'recovery-import.html',\n})\nexport class RecoveryImportPage {\n    opts :string;\n    alert:Alert;\n    modal:Modal;\n    loading:Loading;\n    accountname:string;\n    getKeyBrain:string='';\n    account:any;\n    brainKey:string;\n    indexedDB = window.indexedDB ;\n    translateObj: any;\n    if(indexedDB)\n    {\n    console.log(\"你的浏览器不支持IndexedDB\");\n    }\n  constructor(public navCtrl: NavController, public navParams: NavParams,\n              public alertCtrl:AlertController,\n              public modalCtrl:ModalController,\n              public toastCtrl:ToastController,\n              public pincodeCtrl: PincodeController,\n              public storageService:StorageService,\n              public recoveryImportService:RecoveryImportService,\n              public commonUtils:CommonUtils,\n              public translate:TranslateService) {\n\n        this.account = storageService.read('userid');\n      this.translate.get('recovery_import').subscribe((res: any) => {\n          this.translateObj = res;\n      });\n  }\n\n  ionViewDidLoad() {\n\n    console.log('ionViewDidLoad RecoveryImportPage');\n  }\n\n    goBack(){\n        this.navCtrl.pop();\n    }\n  alertCommon(title,subTitle){\n      this.alert = this.alertCtrl.create({\n          title: title,\n          subTitle: subTitle,\n          buttons: [\n              {\n                  text: this.translateObj.ok,\n                  handler: data => {\n                  }\n              }\n          ]\n      });\n      this.alert.present();\n  }\n  returnZXH(zhanghuming){\n        console.log(\"zhanghuming\",zhanghuming);\n        return new Promise((resolve, reject)=>{\n            localStorage.setItem(\"account\",zhanghuming);\n            let obj={\n                    flag:0,\n                    // value: this.translateObj.accountExists\n                    account:zhanghuming\n            };\n            resolve(obj)\n            // if(zhanghuming==user){  //和规则相同 允许导入\n            //     let obj={\n            //         flag:0,\n            //         value: this.translateObj.accountExists\n            //     };\n            //     resolve(obj)\n            //     // //链 导入脑钥 和生成规则不相同，那就肯定不能导入了\n            //     // if(localStorage.getItem(\"account\") != NewpayInstance.getCurAccountLocalKey() ){\n            //     //     this.alertCommon(this.translateObj.warning, this.translateObj.IfMatching);\n            //     //     console.log(\"不为null\")\n            //     //     return;\n            //     // }\n            // }else if(zhanghuming !=user){\n            //     let obj={\n            //         flag:1,\n            //         value: this.translateObj.accountNoExists\n            //     };\n            //     resolve(obj)\n            //     // this.commonUtils.alertCommon('提示','账户在本系统不存在');\n            //     //return;\n            // }\n        }).catch()\n\n    }\n  recoveryKey(){\n      if(this.getKeyBrain.length==0){\n          this.alertCommon(this.translateObj.warning, this.translateObj.inputBrainKey);\n          return;\n      }\n      if(this.getKeyBrain.length<50){\n          this.alertCommon(this.translateObj.warning, this.translateObj.morethen15);\n          return;\n      }\n      let pinCode =  this.pincodeCtrl.create({\n          title:'输入密码'\n      });\n\n      pinCode.present();\n\n      pinCode.onDidDismiss( (code,status) => {\n    console.log(this.getKeyBrain.length)\n      //创建之前 要 删除本地数据库的数据 获取getRootDatabaseName getDatabaseName\n            console.log(code)\n            console.log(NewpayInstance.validatePassword(code))\n          if(NewpayInstance.validatePassword(code)){\n              // 先验证密码的正确性，如果密码都不正确后续操作全部不能执行。 如果密码正确 验证账户的正确性账户为当前登录用户 那就恢复脑钥\n              this.commonUtils.showLoading();\n              //验证成功&& WalletDb.validatePassword(data.pwd, true)\n              console.log(this.getKeyBrain)\n              // 初始化\n              NewpayInstance.importBrainKey(\"default\", this.getKeyBrain, this.returnZXH.bind(this),code).then(() => {\n                  this.commonUtils.HideLoading();\n\n                  //重置密码，导入成功，   提交到中心 服务器\n                  console.log(\"导入成功\");\n                  console.log( NewpayInstance.getCurAccountLocalKey())\n                  this.brainKey =  NewpayInstance.exportBrainKey()\n                  console.log(this.brainKey);\n                  localStorage.setItem(\"brainKey\",this.brainKey);\n                  //如果是导入 WalletManagerStore.onSetWallet（ 钱包名，钱包密码，脑钥）返回的是 成功不成功\n                  this.navCtrl.push('TabsPage');\n              }).catch((err) => {\n                  this.commonUtils.HideLoading();\n                  console.log(err);\n                  this.alertCommon('提示', '脑钥错误,请重新导入');\n              })\n          }else{\n            this.commonUtils.alertCommon(\"\",\"密码错误\")\n          }\n\n      })\n  }\n    ionViewWillLeave(){\n        if(this.alert){\n            this.alert.dismiss();\n        }\n        if(this.loading){\n            this.loading.dismiss();\n        }\n\n        if(this.modal){\n            this.modal.dismiss();\n        }\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/mine/my-wallet/recovery-import/recovery-import.ts","import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { RecoveryImportPage } from './recovery-import';\nimport { TranslateModule} from 'ng2-translate';\n\n@NgModule({\n  declarations: [\n    RecoveryImportPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(RecoveryImportPage),TranslateModule\n  ],\n})\nexport class RecoveryImportPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/mine/my-wallet/recovery-import/recovery-import.module.ts"],"sourceRoot":""}